<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sellas.web.myPage.MyPageDAO">

<select id="findId" parameterType="String" resultType="com.sellas.web.myPage.ReviewDTO">

SELECT pno, tno, pseller, pbuyer, pstate FROM payment
WHERE tno=#{tno} AND pstate=0

</select>



<insert id="inputReview" parameterType="com.sellas.web.myPage.ReviewDTO">
INSERT INTO review (pno, mwriter, rcontent, rpoint, mtarget)
VALUES(#{pno}, #{muuid}, #{rcontent}, #{rpoint},#{targetMember})
</insert>


<update id="updatePoint" parameterType="com.sellas.web.myPage.ReviewDTO">
UPDATE member SET mpoint=mpoint+#{rpoint} WHERE muuid=#{targetMember}
</update>


<select id="getprofileReview" parameterType="Object" resultType="Map">
	SELECT rno, pno, mwriter, rcontent, rdate
	FROM review
	WHERE mtarget=#{muuid}
</select>



<select id="memberInfo" parameterType="String" resultType="Map">
	SELECT mnickname, mpoint
	FROM member
	WHERE muuid=#{uuid}
</select>


<select id="isNicknameExists" parameterType="String" resultType="int">
	SELECT COUNT(*)
	FROM member
	WHERE mnickname=#{newNickname}
</select>


<update id="nicknameModify" parameterType="Map">
UPDATE member SET mnickname=#{newNickname} WHERE muuid=#{uuid}
</update>

<select id="reviewDetail" parameterType="Integer" resultType="Map">
SELECT r.mwriter, r.rcontent, rdate, t.ttitle, m.mnickname
FROM review r
JOIN payment p ON r.pno = p.pno
JOIN trade t ON p.tno = t.tno
JOIN member m ON r.mwriter = m.muuid
WHERE rno=#{rno}
</select>



<select id="getSell" parameterType="String" resultType="Map">
SELECT t.tno, t.ttitle, t.tnormalprice, t.tnormalstate, t.tdate, ti.timage
FROM trade t
JOIN tradeimage ti ON t.tno = ti.tno
WHERE t.muuid =#{uuid} AND ti.tthumbnail = 0
</select>

<select id="hasReview" parameterType="String" resultType="Map">
SELECT r.rno, r.pno, p.tno
FROM review r
JOIN payment p ON r.pno = p.pno
JOIN trade t ON p.tno= t.tno
WHERE mwriter=#{uuid}
</select>


<select id="getBuy" parameterType="String" resultType="Map">
SELECT pno, penddate, t.tno, t.ttitle, t,tdate, t.tnormalprice, ti.timage, t.tnormalstate
FROM payment p
JOIN trade t ON p.tno = t.tno
JOIN tradeimage ti ON t.tno = ti.tno
WHERE pbuyer=#{uuid} AND pstate = 0 AND ti.tthumbnail = 0
</select>





</mapper>