<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sellas.web.trade.NormalDAO">

<select id="normalBoardList" resultType="Map">
SELECT *
FROM normaltradeview
</select>



<select id="cateList" resultType="Map">
SELECT *
FROM itemcategory
ORDER BY ino ASC
</select>

<select id="mainMember" parameterType="String" resultType="Map">
SELECT *
FROM member
WHERE muuid = #{muuid}
</select>

<insert id="normalWrite" parameterType="Map">
INSERT INTO trade (ino, muuid, ttype, ttitle, tcontent, tnormalprice, tnormalstate)
VALUES (#{category},#{muuid},#{ttype},#{ttitle},#{tcontent},#{tnormalprice}, #{tnormalstate})

 <selectKey keyProperty="tno" order="AFTER" resultType="java.lang.Integer">
        SELECT LAST_INSERT_ID() AS tno
    </selectKey>
</insert>


<insert id="insertTradeimg" parameterType="Map">
	INSERT INTO tradeimage (tno, timage)
	VALUES (#{tno}, #{realFileName})
</insert>

<update id="setThumbnail" parameterType="String">
UPDATE tradeimage
SET tthumbnail = 0
WHERE timage = #{realFileName}
</update>



<select id="normalDetail" parameterType="Integer" resultType="Map">
SELECT *
FROM normaltradeview
WHERE tno = #{tno}
</select>

<select id="normalDetailCount" parameterType="Integer" resultType="Integer">
SELECT COUNT(*)
FROM tradeimage
WHERE tno  = #{tno}
</select>

<select id="normalDetailImage" parameterType="Integer" resultType="Map">
SELECT timage
FROM tradeimage
WHERE tno = #{tno}
</select>

<update id="normalDelete" parameterType="Map">
UPDATE trade
SET tnormalstate = 3
WHERE tno = #{tno} and muuid=#{muuid}
</update>

<insert id="fillWhalePay">
INSERT INTO fill (muuid, camount)
VALUES ((SELECT muuid FROM member WHERE mno = #{mno}), #{money})
</insert>
</mapper>